{% load static %}

<!DOCTYPE html>
<html>

<head>
    <title>Lumpia.natics System</title>
    <link rel="stylesheet" type="text/css" href="{% static '/bootstrap-5.3.0-alpha1-dist/css/bootstrap.css' %}">
    <meta charset="utf-8">
</head>

<body>
    <div class="container mt-5">
        <div>
            <form method="POST" action="{% url 'confirm_inventory' %}" onsubmit="validate();">{% csrf_token %}
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Item Name</th>
                            <th>Counted Units</th>
                            <th>Remarks</th>
                            <th>Remaining Inventory</th>
                        </tr>
                    </thead>

                    {% for group in groups %}
                        <tr style="background-color:rgb(190, 245, 190)">
                            <td><b>{{group.group_id}}</b></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    {% for p in products %}
                    {% if p.group_name == group %}
                    <tr>
                        <td class="item">{{p.name}}</td>
                        <td><input type="text" name="counted_units" class="counted_units" value="0"></td>
                        <td><input type="text" name="remarks" value="" class="remark"></td>
                        <td class="final_stocks text-end">{{p.stocks}}</td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                    {% endfor %}

                </table>
                <div class="row mt-5">
                    <div class="col">
                        <h1>Inventory Tally</h1>
                        <h3>{{current_date}}</h3>
                    </div>
                    <div class="col mt-5">
                        <button type="submit" class="btn btn-success submit_button float-end">Record</button>
                        <a href="{% url 'home' %}" class="btn btn-danger float-end me-2">Return to Home</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
        <script>
           function validate()
           {
            item = document.getElementsByClassName("item");
            counted_units = document.getElementsByClassName("counted_units");
            final_stocks = document.getElementsByClassName("final_stocks");
            remarks = document.getElementsByClassName("remark");
            invalid = [];

            for (let i = 0; i < document.getElementsByClassName("counted_units").length; i++)
            {
                items = item[i].innerHTML;
                comparison = final_stocks[i].innerHTML;
                input = counted_units[i].value;
                input_remark = remarks[i].value;

                comparison = Number(comparison);
                input = Number(input);
                
                if (comparison != input && input_remark == "")
                {
                    invalid.push(items);
                }
            }

            if (invalid.length > 0)
            {
                alert_msg = "Double-check the following: \n";
                for (let j = 0; j < invalid.length ; j++)
                {
                    alert_msg += invalid[j] + "\n";
                }
                alert(alert_msg);
                return event.preventDefault();
            }

            if (invalid.length == 0)
            {
                console.log("true");
                return true;
            }
           }
        </script>

</body>

</html>